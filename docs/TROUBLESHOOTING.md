
# üîß Guia de Solu√ß√£o de Problemas - Precifica+

Este guia ajuda a resolver os problemas mais comuns encontrados no Precifica+.

## üö® Problemas Cr√≠ticos

### (Dev/Test) Falhas de OOM em Testes de Integra√ß√£o

Se a su√≠te de testes travar por dezenas de minutos e encerrar com:

```text
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
```

#### Contexto Atual

- O arquivo `src/__tests__/integration/calculator-flow.test.tsx` foi temporariamente desabilitado (`describe.skip`) para desbloquear o pipeline e evitar consumo excessivo de mem√≥ria (>3.5GB) durante execu√ß√µes completas do Vitest.
- Causa prov√°vel: combina√ß√£o de √°rvore de componentes grande + caches (react-query, hist√≥rico, mocks parciais) + m√∫ltiplas intera√ß√µes `userEvent` acumulando refer√™ncias.

#### Mitiga√ß√£o Aplicada

1. Suite marcada como `skip` com coment√°rio detalhando plano de reintrodu√ß√£o.
2. Testes de unidade + smoke permanecem ativos e cobrindo paths cr√≠ticos do c√°lculo.

#### Pr√≥ximos Passos Planejados

- Extrair um harness leve da calculadora (sem analytics, sem theming pesado, sem react-query real).
- Mockar completamente providers (auth, query client, analytics) e limitar hist√≥rico a mem√≥ria vol√°til.
- Reintroduzir como `calculator-flow.light.test.tsx` objetivando execu√ß√£o <5s e sem crescimento de heap.
- Migrar cen√°rios mais realistas para camada E2E (Playwright) se necess√°rio.

#### Estado Atual (Teste Leve Introduzido)

Uma variante reduzida j√° foi adicionada em `src/__tests__/smoke/calculator-flow.light.test.tsx` cobrindo:

- Caso feliz m√≠nimo: inserir custo + impostos + taxa e gerar pre√ßo de venda.
- Mocks completos para: `framer-motion`, `HistoryService` (desativado), contexto de auth (usu√°rio an√¥nimo).
- Sem hist√≥rico persistente, sem analytics, sem anima√ß√µes, sem carregamento de √°rvore pesada.

Crit√©rios de sucesso do teste leve:

| Crit√©rio | Objetivo |
|----------|----------|
| Tempo de execu√ß√£o | < 5s local / < 10s CI |
| RSS aproximado | Est√°vel (sem crescimento progressivo) |
| Largura de escopo | Apenas fluxo de c√°lculo b√°sico |
| Independ√™ncia | N√£o requer servi√ßos externos |

Checklist de diagn√≥stico se o teste leve falhar:

1. Labels de acessibilidade (aria-label / textContent) mudaram?
2. Houve introdu√ß√£o de providers pesados no componente renderizado?
3. Entraram novas depend√™ncias n√£o mockadas criando caches grandes?

Expans√£o segura: duplicar o teste leve e adicionar um segundo cen√°rio, monitorando tempo total (< 15s agregado). Evitar loops ou m√∫ltiplas execu√ß√µes repetitivas de intera√ß√µes de usu√°rio.

#### A√ß√£o Caso Necessite Reativar Agora

1. Remova `describe.skip` em `calculator-flow.test.tsx`.
2. Rode localmente:

   ```bash
   npx vitest run src/__tests__/integration/calculator-flow.test.tsx --maxWorkers=1 --no-threads
   ```

3. Se ainda crescer mem√≥ria, experimentar flag Node:

   ```bash
   set NODE_OPTIONS=--max-old-space-size=4096 & npx vitest run src/__tests__/integration/calculator-flow.test.tsx
   ```

> Issue recomendada: "Refatorar integra√ß√£o Calculator Flow para vers√£o leve".


### App n√£o carrega/Tela branca

#### Poss√≠veis Causas
- Cache do navegador corrompido
- JavaScript desabilitado
- Extens√µes do navegador interferindo
- Problemas de conectividade

#### Solu√ß√µes

1. **Limpar Cache do Navegador**
   ```
   Chrome: Ctrl+Shift+Del > Limpar dados de navega√ß√£o
   Firefox: Ctrl+Shift+Del > Limpar dados
   Safari: Cmd+Option+E > Esvaziar caches
   ```

2. **Verificar JavaScript**
   - Chrome: Configura√ß√µes > Privacidade > Configura√ß√µes do site > JavaScript
   - Certifique-se que est√° "Permitido"

3. **Modo Inc√≥gnito/Privado**
   - Teste o app em modo inc√≥gnito
   - Se funcionar, o problema s√£o extens√µes ou cache

4. **Desabilitar Extens√µes**
   - Desative todas as extens√µes temporariamente
   - Reative uma por vez para identificar conflitos

### Erro de Autentica√ß√£o

#### Sintomas
- "Sess√£o expirada"
- "Token inv√°lido"
- Redirecionamento para login constantemente

#### Solu√ß√µes

1. **Fazer Logout/Login**
   ```
   1. Clique em seu avatar > Sair
   2. Aguarde 10 segundos
   3. Fa√ßa login novamente
   4. Verifique se o problema persiste
   ```

2. **Limpar Storage Local**
   ```
   No navegador:
   F12 > Application > Local Storage > precifica.app
   Clique em "Clear All"
   ```

3. **Verificar Email de Confirma√ß√£o**
   - Verifique se confirmou seu email
   - Procure por emails na pasta spam
   - Reenvie confirma√ß√£o se necess√°rio

## üìä Problemas de C√°lculo

### Resultados Incorretos

#### Verifica√ß√µes B√°sicas

1. **Conferir Dados de Entrada**
   ```
   ‚úì Custo em formato correto (100.50)
   ‚úì Margem em percentual (30 = 30%)
   ‚úì Impostos configurados corretamente
   ‚úì Regime tribut√°rio selecionado
   ```

2. **Validar Configura√ß√µes**
   - Acesse Configura√ß√µes > Neg√≥cio
   - Verifique impostos padr√£o
   - Confirme regime tribut√°rio
   - Teste com configura√ß√µes manuais

#### Problemas Espec√≠ficos

**Margem muito baixa/alta:**
```
Problema: Margem calculada diferente do esperado
Causa: Impostos/taxas n√£o considerados na base de c√°lculo
Solu√ß√£o: Revisar m√©todo de c√°lculo nas configura√ß√µes
```

**Impostos n√£o aplicados:**
```
Problema: Resultado sem impostos
Causa: Regime tribut√°rio n√£o configurado
Solu√ß√£o: Configurar regime em Configura√ß√µes > Neg√≥cio
```

### Calculadora Travada

#### Sintomas
- Bot√£o "Calcular" n√£o responde
- Campos n√£o aceitam entrada
- Interface congelada

#### Solu√ß√µes

1. **Refresh da P√°gina**
   - Pressione F5 ou Ctrl+R
   - Se PWA instalado, feche e reabra

2. **Verificar Console de Erros**
   ```
   1. Pressione F12
   2. V√° para aba "Console"
   3. Procure por erros em vermelho
   4. Capture screenshot e reporte
   ```

3. **Testar Calculadora B√°sica**
   - Use apenas campos obrigat√≥rios
   - Se funcionar, problema √© com campos avan√ßados

## üìà Problemas de Analytics

### Dashboard n√£o carrega

#### Poss√≠veis Causas
- Problemas de conectividade
- Dados corrompidos
- Cache desatualizado

#### Solu√ß√µes

1. **Verificar Conex√£o**
   ```
   1. Teste outros sites
   2. Verifique velocidade da internet
   3. Tente connection m√≥vel (4G/5G)
   ```

2. **For√ßar Atualiza√ß√£o**
   - Clique no bot√£o "Atualizar" no dashboard
   - Aguarde carregamento completo
   - Verifique se dados aparecem

3. **Verificar Per√≠odo**
   - Mude o per√≠odo de an√°lise
   - Teste com "√öltimo m√™s"
   - Alguns per√≠odos podem ter poucos dados

### M√©tricas Zeradas

#### Diagn√≥stico
```
Se todas as m√©tricas mostram zero:
‚îú‚îÄ‚îÄ Problema de conex√£o com banco
‚îú‚îÄ‚îÄ Filtros muito restritivos
‚îî‚îÄ‚îÄ Dados ainda n√£o processados

Se apenas algumas m√©tricas:
‚îú‚îÄ‚îÄ Configura√ß√£o espec√≠fica
‚îú‚îÄ‚îÄ Permiss√µes de dados
‚îî‚îÄ‚îÄ Integra√ß√£o espec√≠fica
```

#### Solu√ß√µes

1. **Verificar Filtros**
   - Remova todos os filtros
   - Use per√≠odo "Tudo"
   - Verifique se dados aparecem

2. **Aguardar Processamento**
   - Dados podem levar at√© 1h para aparecer
   - Analytics √© atualizado a cada 30 minutos
   - Dados hist√≥ricos podem demorar mais

## ü§ñ Problemas de IA

### IA n√£o responde

#### Poss√≠veis Causas
- Cota de API excedida
- Problema tempor√°rio do servi√ßo
- Entrada inv√°lida

#### Solu√ß√µes

1. **Aguardar e Tentar Novamente**
   - Aguarde 1-2 minutos
   - Tente uma pergunta mais simples
   - Verifique se n√£o h√° caracteres especiais

2. **Reformular Pergunta**
   ```
   ‚ùå Evite: "Como calcular pre√ßo p/ produto xyz com margem alta?"
   ‚úÖ Use: "Qual margem ideal para produtos eletr√¥nicos?"
   ```

3. **Verificar Status do Servi√ßo**
   - Acesse p√°gina de status (se dispon√≠vel)
   - Verifique redes sociais oficiais
   - Entre em contato com suporte

### Recomenda√ß√µes Inconsistentes

#### Sintomas
- IA sugere pre√ßos muito altos/baixos
- Recomenda√ß√µes contradit√≥rias
- Confian√ßa muito baixa (<50%)

#### Solu√ß√µes

1. **Fornecer Mais Contexto**
   ```
   Em vez de apenas "Smartphone"
   Use: "Smartphone Samsung Galaxy A54, custo R$ 800, mercado classe B"
   ```

2. **Validar Dados de Entrada**
   - Custo realista para o produto
   - Categoria correta
   - Marketplace espec√≠fico

3. **Considerar Como Sugest√£o**
   - IA oferece ponto de partida
   - Sempre validar com conhecimento do mercado
   - Usar como segunda opini√£o

## üì± Problemas PWA/Mobile

### PWA n√£o instala

#### No Android

1. **Verificar Navegador**
   - Use Chrome ou Edge
   - Firefox pode ter problemas
   - Atualize para vers√£o mais recente

2. **Verificar Configura√ß√µes**
   ```
   Chrome > Configura√ß√µes > Site Settings
   > Notifications > Permitir
   > Pop-ups > Permitir para precifica.app
   ```

#### No iOS

1. **Usar Safari**
   - PWA no iOS s√≥ funciona no Safari
   - Chrome/Firefox n√£o suportam instala√ß√£o

2. **Seguir Passos Corretos**
   ```
   1. Abra site no Safari
   2. Toque no bot√£o compartilhar
   3. Role at√© "Adicionar √† Tela Inicial"
   4. Confirme instala√ß√£o
   ```

### App Offline n√£o funciona

#### Verifica√ß√µes

1. **Teste de Conectividade**
   ```
   1. Abra o app
   2. Desligue WiFi/dados m√≥veis
   3. Teste calculadora b√°sica
   4. Deve funcionar normalmente
   ```

2. **Verificar Service Worker**
   ```
   F12 > Application > Service Workers
   Deve mostrar service worker ativo
   ```

3. **Limpar Cache do App**
   ```
   Configura√ß√µes > Storage > precifica.app
   Limpar cache (mas n√£o dados)
   ```

## üîê Problemas de Seguran√ßa

### Suspeita de Conta Comprometida

#### Sinais de Alerta
- Login de locais desconhecidos
- Configura√ß√µes alteradas sem seu conhecimento
- C√°lculos que voc√™ n√£o fez no hist√≥rico

#### A√ß√µes Imediatas

1. **Alterar Senha**
   ```
   1. Configura√ß√µes > Seguran√ßa > Alterar Senha
   2. Use senha forte e √∫nica
   3. N√£o reutilize de outros sites
   ```

2. **Verificar Sess√µes Ativas**
   - Veja todos os dispositivos logados
   - Desconecte dispositivos desconhecidos
   - Ative 2FA se dispon√≠vel

3. **Verificar Configura√ß√µes**
   - Revise todas as configura√ß√µes
   - Verifique integra√ß√µes ativas
   - Confirme dados de contato

### Problemas de Privacidade

#### Dados sendo compartilhados
- Revise configura√ß√µes de privacidade
- Desative integra√ß√µes desnecess√°rias
- Entre em contato para esclarecimentos

## üåê Problemas de Conex√£o

### Site lento/inst√°vel

#### Diagn√≥stico de Rede

1. **Teste de Velocidade**
   ```
   Use speedtest.net para verificar:
   - Download > 10 Mbps (m√≠nimo)
   - Upload > 1 Mbps (m√≠nimo)  
   - Lat√™ncia < 100ms (ideal)
   ```

2. **Teste de DNS**
   ```
   Tente usar DNS p√∫blico:
   - Google: 8.8.8.8 e 8.8.4.4
   - Cloudflare: 1.1.1.1 e 1.0.0.1
   ```

#### Otimiza√ß√µes

1. **Fechar Abas Desnecess√°rias**
   - Cada aba consome recursos
   - Feche outros apps pesados

2. **Verificar Extens√µes**
   - AdBlocks podem interferir
   - VPNs podem causar lentid√£o
   - Desative temporariamente para testar

### Timeouts/Desconex√µes

#### Solu√ß√µes Tempor√°rias

1. **Refresh Peri√≥dico**
   - Recarregue a p√°gina se inst√°vel
   - Salve trabalho importante frequently

2. **Modo Offline**
   - Use calculadora b√°sica offline
   - Sincronize quando conex√£o melhorar

## üõ†Ô∏è Ferramentas de Diagn√≥stico

### Console do Navegador

```javascript
// Verificar estado da aplica√ß√£o
console.log(localStorage.getItem('supabase.auth.token'));
console.log(navigator.onLine); // Status da conex√£o
console.log(navigator.serviceWorker.controller); // Service Worker
```

### Verifica√ß√£o de Sa√∫de

1. **Acesse** Configura√ß√µes > Sistema > Diagn√≥stico
2. **Execute** teste de conectividade
3. **Verifique** todos os servi√ßos
4. **Exporte** relat√≥rio se necess√°rio

### Informa√ß√µes do Sistema

```
Para reportar problemas, inclua:
‚îú‚îÄ‚îÄ Navegador e vers√£o
‚îú‚îÄ‚îÄ Sistema operacional  
‚îú‚îÄ‚îÄ Vers√£o do app
‚îú‚îÄ‚îÄ Passos para reproduzir
‚îî‚îÄ‚îÄ Screenshots dos erros
```

## üìû Quando Contatar o Suporte

### Problemas que Exigem Suporte

- ‚ùå App n√£o carrega ap√≥s seguir todas as solu√ß√µes
- ‚ùå Dados perdidos ou corrompidos
- ‚ùå Problemas de cobran√ßa/pagamento
- ‚ùå Suspeita de bug no sistema
- ‚ùå Solicita√ß√µes de recursos/melhorias

### Informa√ß√µes para Incluir

```
T√≠tulo: [Problema] - Descri√ß√£o curta

Descri√ß√£o:
1. O que voc√™ tentava fazer?
2. O que aconteceu de errado?
3. J√° tentou as solu√ß√µes do guia?
4. Quando come√ßou o problema?

Ambiente:
- Navegador: Chrome 120.0
- SO: Windows 11
- Dispositivo: Desktop/Mobile
- Vers√£o do app: 1.2.3
```

### Canais de Suporte

1. **Chat Online**: Resposta imediata
2. **Email**: suporte@precifica.app
3. **WhatsApp**: +55 11 99999-9999
4. **Discord**: Comunidade t√©cnica

---

## ‚úÖ Checklist de Solu√ß√£o

Antes de contatar o suporte, verifique:

- [ ] Tentei recarregar a p√°gina (F5)
- [ ] Testei em modo inc√≥gnito
- [ ] Limpei cache do navegador
- [ ] Verifiquei conex√£o com internet
- [ ] Testei em outro navegador
- [ ] Consultei este guia de troubleshooting
- [ ] Verifiquei se n√£o √© manuten√ß√£o programada

Se nada funcionar, nosso suporte est√° aqui para ajudar! üöÄ
